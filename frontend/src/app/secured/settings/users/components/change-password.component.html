<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Change Password</h5>
          <p class="text-muted">Update your password to keep your account secure</p>

          <!-- Success Message -->
          <div class="alert alert-success alert-dismissible fade show" *ngIf="success">
            <i class="bi bi-check-circle-fill me-2"></i>
            {{ success }}
            <button type="button" class="btn-close" (click)="success = ''"></button>
          </div>

          <!-- Error Message -->
          <div class="alert alert-danger alert-dismissible fade show" *ngIf="error" style="white-space: pre-line;">
            <i class="bi bi-exclamation-circle-fill me-2"></i>
            {{ error }}
            <button type="button" class="btn-close" (click)="error = ''"></button>
          </div>

          <form [formGroup]="form" (ngSubmit)="onSubmit()" class="mt-4">

            <!-- Current Password -->
            <div class="row mb-3">
              <label for="currentPassword" class="col-sm-3 col-form-label">Current Password</label>
              <div class="col-sm-9">
                <input
                  type="password"
                  class="form-control"
                  id="currentPassword"
                  formControlName="currentPassword"
                  required>
                <div class="invalid-feedback" *ngIf="form.controls.currentPassword.invalid && form.controls.currentPassword.touched">
                  Current password is required
                </div>
              </div>
            </div>

            <!-- New Password -->
            <div class="row mb-3">
              <label for="newPassword" class="col-sm-3 col-form-label">New Password</label>
              <div class="col-sm-9">
                <input
                  type="password"
                  class="form-control"
                  id="newPassword"
                  formControlName="newPassword"
                  required>
                <div class="invalid-feedback" *ngIf="form.controls.newPassword.invalid && form.controls.newPassword.touched">
                  New password is required
                </div>

                <!-- Password Strength Indicator -->
                <app-password-strength-indicator
                  [password]="form.value.newPassword || ''"
                  [showRequirements]="true">
                </app-password-strength-indicator>
              </div>
            </div>

            <!-- Confirm Password -->
            <div class="row mb-3">
              <label for="confirmPassword" class="col-sm-3 col-form-label">Confirm New Password</label>
              <div class="col-sm-9">
                <input
                  type="password"
                  class="form-control"
                  [class.is-invalid]="showPasswordMismatch"
                  [class.is-valid]="form.controls.confirmPassword.dirty && passwordsMatch && form.value.confirmPassword !== ''"
                  id="confirmPassword"
                  formControlName="confirmPassword"
                  required>
                <div class="invalid-feedback" *ngIf="showPasswordMismatch">
                  Passwords do not match
                </div>
                <div class="valid-feedback" *ngIf="form.controls.confirmPassword.dirty && passwordsMatch && form.value.confirmPassword !== ''">
                  Passwords match
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="row">
              <div class="col-sm-9 offset-sm-3">
                <button
                  type="submit"
                  class="btn btn-primary me-2"
                  [disabled]="!form.valid || !passwordsMatch || loading">
                  <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status"></span>
                  {{ loading ? 'Changing Password...' : 'Change Password' }}
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  (click)="cancel()"
                  [disabled]="loading">
                  Cancel
                </button>
              </div>
            </div>

          </form>
        </div>
      </div>
    </div>
  </div>
</div>
