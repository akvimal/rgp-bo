<div class="container-fluid">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h2>GSTR-1 Report</h2>
          <p class="text-muted mb-0">Outward Supplies (Sales) - Monthly Return</p>
        </div>
        <div>
          <a routerLink="/secure/reports/gst/dashboard" class="btn btn-sm btn-outline-secondary mr-2">
            <i class="fa fa-arrow-left"></i> Back to Dashboard
          </a>
          <button class="btn btn-sm btn-outline-primary" (click)="refresh()">
            <i class="fa fa-refresh"></i> Refresh
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Month Selector -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between">
            <button class="btn btn-sm btn-outline-secondary" (click)="previousMonth()">
              <i class="bi bi-chevron-left"></i> Previous
            </button>
            <h4 class="mb-0">{{ getMonthDisplay() }}</h4>
            <button class="btn btn-sm btn-outline-secondary" (click)="nextMonth()">
              Next <i class="bi bi-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h6 class="text-muted mb-1">Filing Due Date</h6>
          <h5 class="mb-0">11th of next month</h5>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="row mb-4">
    <div class="col-12">
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <a class="nav-link" [class.active]="activeTab === 'b2b'" (click)="setActiveTab('b2b')">
            <i class="fa fa-building"></i> B2B (Table 4)
            <span class="badge badge-primary ml-2">{{ b2bSales.length }}</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [class.active]="activeTab === 'b2c-large'" (click)="setActiveTab('b2c-large')">
            <i class="fa fa-shopping-cart"></i> B2C Large (Table 6C)
            <span class="badge badge-primary ml-2">{{ b2cLarge.length }}</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [class.active]="activeTab === 'b2c-small'" (click)="setActiveTab('b2c-small')">
            <i class="fa fa-shopping-basket"></i> B2C Small (Table 7)
            <span class="badge badge-primary ml-2">{{ b2cSmall.length }}</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [class.active]="activeTab === 'hsn'" (click)="setActiveTab('hsn')">
            <i class="fa fa-barcode"></i> HSN Summary (Table 12)
            <span class="badge badge-primary ml-2">{{ hsnSummary.length }}</span>
          </a>
        </li>
      </ul>
    </div>
  </div>

  <!-- B2B Sales (Table 4) -->
  <div class="row" *ngIf="activeTab === 'b2b'">
    <div class="col-12">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">B2B Sales - Business to Business (> ₹0)</h5>
          <button class="btn btn-sm btn-success" (click)="exportB2bToCsv()" [disabled]="b2bSales.length === 0">
            <i class="fa fa-download"></i> Export CSV
          </button>
        </div>
        <div class="card-body">
          <div *ngIf="loadingB2b" class="text-center py-4">
            <div class="spinner-border" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>

          <div *ngIf="!loadingB2b && b2bSales.length === 0" class="alert alert-info">
            No B2B sales found for this period.
          </div>

          <div *ngIf="!loadingB2b && b2bSales.length > 0">
            <div class="table-responsive">
              <table class="table table-sm table-hover">
                <thead>
                  <tr>
                    <th>GSTIN</th>
                    <th>Customer Name</th>
                    <th>Invoice No</th>
                    <th>Invoice Date</th>
                    <th class="text-right">Taxable Value</th>
                    <th class="text-center">Tax Rate</th>
                    <th class="text-right">CGST</th>
                    <th class="text-right">SGST</th>
                    <th class="text-right">IGST</th>
                    <th class="text-right">Invoice Value</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of b2bSales">
                    <td>
                      <small>{{ item.customer_gstin }}</small>
                    </td>
                    <td>{{ item.customer_name }}</td>
                    <td>{{ item.bill_no }}</td>
                    <td>{{ formatDate(item.sale_date) }}</td>
                    <td class="text-right">{{ formatCurrency(item.taxable_value) }}</td>
                    <td class="text-center">{{ item.tax_rate }}%</td>
                    <td class="text-right">{{ formatCurrency(item.cgst_amount) }}</td>
                    <td class="text-right">{{ formatCurrency(item.sgst_amount) }}</td>
                    <td class="text-right">{{ formatCurrency(item.igst_amount) }}</td>
                    <td class="text-right"><strong>{{ formatCurrency(item.invoice_value) }}</strong></td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr class="table-active">
                    <th colspan="4">Total</th>
                    <th class="text-right">{{ formatCurrency(getB2bTotalTaxableValue()) }}</th>
                    <th></th>
                    <th colspan="3" class="text-right">{{ formatCurrency(getB2bTotalTax()) }}</th>
                    <th class="text-right">{{ formatCurrency(getB2bTotalInvoiceValue()) }}</th>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- B2C Large (Table 6C) -->
  <div class="row" *ngIf="activeTab === 'b2c-large'">
    <div class="col-12">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">B2C Large Sales - Business to Consumer (> ₹2.5 Lakhs)</h5>
          <button class="btn btn-sm btn-success" (click)="exportB2cLargeToCsv()" [disabled]="b2cLarge.length === 0">
            <i class="fa fa-download"></i> Export CSV
          </button>
        </div>
        <div class="card-body">
          <div *ngIf="loadingB2cLarge" class="text-center py-4">
            <div class="spinner-border" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>

          <div *ngIf="!loadingB2cLarge && b2cLarge.length === 0" class="alert alert-info">
            No B2C large sales found for this period.
          </div>

          <div *ngIf="!loadingB2cLarge && b2cLarge.length > 0">
            <div class="table-responsive">
              <table class="table table-sm table-hover">
                <thead>
                  <tr>
                    <th>Invoice No</th>
                    <th>Invoice Date</th>
                    <th class="text-right">Taxable Value</th>
                    <th class="text-center">Tax Rate</th>
                    <th class="text-right">CGST</th>
                    <th class="text-right">SGST</th>
                    <th class="text-right">IGST</th>
                    <th class="text-right">Invoice Value</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of b2cLarge">
                    <td>{{ item.bill_no }}</td>
                    <td>{{ formatDate(item.sale_date) }}</td>
                    <td class="text-right">{{ formatCurrency(item.taxable_value) }}</td>
                    <td class="text-center">{{ item.tax_rate }}%</td>
                    <td class="text-right">{{ formatCurrency(item.cgst_amount) }}</td>
                    <td class="text-right">{{ formatCurrency(item.sgst_amount) }}</td>
                    <td class="text-right">{{ formatCurrency(item.igst_amount) }}</td>
                    <td class="text-right"><strong>{{ formatCurrency(item.invoice_value) }}</strong></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- B2C Small (Table 7) -->
  <div class="row" *ngIf="activeTab === 'b2c-small'">
    <div class="col-12">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">B2C Small Sales Summary (≤ ₹2.5 Lakhs)</h5>
          <button class="btn btn-sm btn-success" (click)="exportB2cSmallToCsv()" [disabled]="b2cSmall.length === 0">
            <i class="fa fa-download"></i> Export CSV
          </button>
        </div>
        <div class="card-body">
          <div *ngIf="loadingB2cSmall" class="text-center py-4">
            <div class="spinner-border" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>

          <div *ngIf="!loadingB2cSmall && b2cSmall.length === 0" class="alert alert-info">
            No B2C small sales found for this period.
          </div>

          <div *ngIf="!loadingB2cSmall && b2cSmall.length > 0">
            <div class="alert alert-info">
              <i class="fa fa-info-circle"></i>
              This is a summary report grouped by tax rate. Individual invoice details are not required for B2C Small sales.
            </div>
            <div class="table-responsive">
              <table class="table table-sm table-hover">
                <thead>
                  <tr>
                    <th class="text-center">Tax Rate</th>
                    <th class="text-right">Total Taxable Value</th>
                    <th class="text-right">CGST</th>
                    <th class="text-right">SGST</th>
                    <th class="text-right">IGST</th>
                    <th class="text-right">Total Tax</th>
                    <th class="text-right">Total Invoice Value</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of b2cSmall">
                    <td class="text-center">{{ item.tax_rate }}%</td>
                    <td class="text-right">{{ formatCurrency(item.total_taxable_value) }}</td>
                    <td class="text-right">{{ formatCurrency(item.total_cgst) }}</td>
                    <td class="text-right">{{ formatCurrency(item.total_sgst) }}</td>
                    <td class="text-right">{{ formatCurrency(item.total_igst) }}</td>
                    <td class="text-right">{{ formatCurrency(item.total_tax) }}</td>
                    <td class="text-right"><strong>{{ formatCurrency(item.total_invoice_value) }}</strong></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- HSN Summary (Table 12) -->
  <div class="row" *ngIf="activeTab === 'hsn'">
    <div class="col-12">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">HSN-wise Summary of Outward Supplies</h5>
          <button class="btn btn-sm btn-success" (click)="exportHsnToCsv()" [disabled]="hsnSummary.length === 0">
            <i class="fa fa-download"></i> Export CSV
          </button>
        </div>
        <div class="card-body">
          <div *ngIf="loadingHsn" class="text-center py-4">
            <div class="spinner-border" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>

          <div *ngIf="!loadingHsn && hsnSummary.length === 0" class="alert alert-info">
            No HSN data found for this period.
          </div>

          <div *ngIf="!loadingHsn && hsnSummary.length > 0">
            <div class="table-responsive">
              <table class="table table-sm table-hover">
                <thead>
                  <tr>
                    <th>HSN Code</th>
                    <th>Description</th>
                    <th>UQC</th>
                    <th class="text-right">Total Qty</th>
                    <th class="text-right">Taxable Value</th>
                    <th class="text-center">Tax Rate</th>
                    <th class="text-right">CGST</th>
                    <th class="text-right">SGST</th>
                    <th class="text-right">IGST</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of hsnSummary">
                    <td><strong>{{ item.hsn_code }}</strong></td>
                    <td>{{ item.description }}</td>
                    <td>{{ item.uqc || 'NOS' }}</td>
                    <td class="text-right">{{ item.total_quantity }}</td>
                    <td class="text-right">{{ formatCurrency(item.taxable_value) }}</td>
                    <td class="text-center">{{ item.tax_rate }}%</td>
                    <td class="text-right">{{ formatCurrency(item.cgst_amount) }}</td>
                    <td class="text-right">{{ formatCurrency(item.sgst_amount) }}</td>
                    <td class="text-right">{{ formatCurrency(item.igst_amount) }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
